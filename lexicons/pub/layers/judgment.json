{
  "lexicon": 1,
  "id": "pub.layers.judgment",
  "description": "Linguistic judgment records for annotation experiments, crowdsourced judgments, and inter-annotator agreement. Inspired by bead's framework for constructing, deploying, and analyzing large-scale linguistic judgment experiments.",
  "defs": {
    "experimentDef": {
      "type": "record",
      "description": "Definition of an annotation or judgment experiment.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["name", "createdAt"],
        "properties": {
          "name": {
            "type": "string",
            "maxLength": 512
          },
          "description": {
            "type": "string",
            "maxLength": 50000
          },
          "taskTypeUri": {
            "type": "string",
            "format": "at-uri",
            "description": "AT-URI of the task type definition node. Community-expandable via knowledge graph."
          },
          "taskType": {
            "type": "string",
            "description": "Task type slug (fallback when taskTypeUri unavailable).",
            "knownValues": [
              "categorical",
              "ordinal",
              "scalar",
              "ranking",
              "span-selection",
              "freetext",
              "pairwise-comparison",
              "best-worst-scaling",
              "acceptability",
              "custom"
            ],
            "maxLength": 128
          },
          "guidelines": {
            "type": "string",
            "maxLength": 100000
          },
          "ontologyRef": {
            "type": "string",
            "format": "at-uri"
          },
          "personaRef": {
            "type": "string",
            "format": "at-uri"
          },
          "corpusRef": {
            "type": "string",
            "format": "at-uri"
          },
          "templateRefs": {
            "type": "array",
            "description": "References to pub.layers.resource#template records used to generate stimuli for this experiment.",
            "maxLength": 64,
            "items": {
              "type": "string",
              "format": "at-uri"
            }
          },
          "collectionRefs": {
            "type": "array",
            "description": "References to pub.layers.resource#collection records providing filler pools for this experiment.",
            "maxLength": 64,
            "items": {
              "type": "string",
              "format": "at-uri"
            }
          },
          "scaleMin": {
            "type": "integer",
            "description": "Minimum scale value for scalar/ordinal judgments."
          },
          "scaleMax": {
            "type": "integer",
            "description": "Maximum scale value."
          },
          "labels": {
            "type": "array",
            "description": "Available labels for categorical judgments.",
            "maxLength": 256,
            "items": {
              "type": "string",
              "maxLength": 512
            }
          },
          "knowledgeRefs": {
            "type": "array",
            "description": "Knowledge graph references (e.g., theoretical framework, methodology citation, task ontology).",
            "maxLength": 32,
            "items": {
              "type": "ref",
              "ref": "pub.layers.defs#knowledgeRef"
            }
          },
          "design": {
            "type": "ref",
            "ref": "#experimentDesign",
            "description": "Experiment design parameters: list constraints, distribution strategy, presentation mode."
          },
          "features": {
            "type": "ref",
            "ref": "pub.layers.defs#featureMap"
          },
          "createdAt": {
            "type": "string",
            "format": "datetime"
          }
        }
      }
    },

    "experimentDesign": {
      "type": "object",
      "description": "Experiment design parameters for item distribution, presentation, and timing.",
      "properties": {
        "listConstraints": {
          "type": "array",
          "description": "Constraints on item list construction (Latin square balancing, no-adjacent-same-condition, etc.).",
          "maxLength": 32,
          "items": {
            "type": "ref",
            "ref": "#listConstraint"
          }
        },
        "distributionStrategyUri": {
          "type": "string",
          "format": "at-uri",
          "description": "AT-URI of the distribution strategy definition node. Community-expandable."
        },
        "distributionStrategy": {
          "type": "string",
          "description": "How items are distributed to annotators.",
          "knownValues": ["latin-square", "random", "blocked", "stratified", "custom"],
          "maxLength": 128
        },
        "presentationModeUri": {
          "type": "string",
          "format": "at-uri",
          "description": "AT-URI of the presentation mode definition node. Community-expandable."
        },
        "presentationMode": {
          "type": "string",
          "description": "How items are ordered within a list.",
          "knownValues": ["random-order", "fixed-order", "blocked", "adaptive", "custom"],
          "maxLength": 128
        },
        "timingMs": {
          "type": "integer",
          "description": "Target timing per item in milliseconds.",
          "minimum": 0
        },
        "features": {
          "type": "ref",
          "ref": "pub.layers.defs#featureMap"
        }
      }
    },

    "listConstraint": {
      "type": "object",
      "description": "A constraint on item list construction for an experiment.",
      "required": ["kind"],
      "properties": {
        "kindUri": {
          "type": "string",
          "format": "at-uri",
          "description": "AT-URI of the constraint kind definition node. Community-expandable."
        },
        "kind": {
          "type": "string",
          "description": "Constraint kind slug.",
          "knownValues": ["latin-square", "no-adjacent-same-condition", "balanced-frequency", "minimum-distance", "custom"],
          "maxLength": 128
        },
        "targetProperty": {
          "type": "string",
          "description": "The item property this constraint operates on (e.g., 'condition', 'templateRef').",
          "maxLength": 256
        },
        "parameters": {
          "type": "ref",
          "ref": "pub.layers.defs#featureMap",
          "description": "Constraint parameters (e.g., minimum distance, number of lists)."
        },
        "constraint": {
          "type": "ref",
          "ref": "pub.layers.defs#constraint",
          "description": "Optional formal constraint expression."
        }
      }
    },

    "judgmentSet": {
      "type": "record",
      "description": "A set of judgments from a single annotator for an experiment.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["experimentRef", "judgments", "createdAt"],
        "properties": {
          "experimentRef": {
            "type": "string",
            "format": "at-uri"
          },
          "agent": {
            "type": "ref",
            "ref": "pub.layers.defs#agentRef",
            "description": "The agent (human annotator, ML model, crowd worker, etc.) who produced this judgment set. Use did for ATProto-native annotators, id for anonymized/platform-specific identifiers, knowledgeRef for ORCID or model cards."
          },
          "judgments": {
            "type": "array",
            "items": {
              "type": "ref",
              "ref": "#judgment"
            }
          },
          "metadata": {
            "type": "ref",
            "ref": "pub.layers.defs#annotationMetadata"
          },
          "knowledgeRefs": {
            "type": "array",
            "description": "Knowledge graph references (e.g., crowdsourcing platform, annotator population, methodology source).",
            "maxLength": 32,
            "items": {
              "type": "ref",
              "ref": "pub.layers.defs#knowledgeRef"
            }
          },
          "features": {
            "type": "ref",
            "ref": "pub.layers.defs#featureMap",
            "description": "Open-ended features (e.g., annotator demographics, session metadata, completion time, payment info)."
          },
          "createdAt": {
            "type": "string",
            "format": "datetime"
          }
        }
      }
    },
    "judgment": {
      "type": "object",
      "description": "A single judgment about a linguistic item.",
      "required": ["item"],
      "properties": {
        "item": {
          "type": "ref",
          "ref": "pub.layers.defs#objectRef",
          "description": "Reference to the item being judged. Use recordRef for the communication/annotation record, objectId for a specific object within it, localId for same-record references."
        },
        "fillingRef": {
          "type": "string",
          "format": "at-uri",
          "description": "Reference to the pub.layers.resource#filling that generated the item being judged."
        },
        "categoricalValue": {
          "type": "string",
          "description": "Categorical judgment label.",
          "maxLength": 512
        },
        "scalarValue": {
          "type": "integer",
          "description": "Scalar/ordinal judgment value."
        },
        "rankValue": {
          "type": "integer",
          "description": "Rank position.",
          "minimum": 0
        },
        "textSpan": {
          "type": "ref",
          "ref": "pub.layers.defs#span",
          "description": "Selected text span for span-selection tasks."
        },
        "freeText": {
          "type": "string",
          "description": "Free-text response.",
          "maxLength": 10000
        },
        "responseTimeMs": {
          "type": "integer",
          "description": "Response time in milliseconds.",
          "minimum": 0
        },
        "confidence": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10000
        },
        "behavioralData": {
          "type": "ref",
          "ref": "pub.layers.defs#featureMap",
          "description": "Behavioral signals: mouse movements, keystroke patterns, eye tracking data, scroll events, etc."
        },
        "features": {
          "type": "ref",
          "ref": "pub.layers.defs#featureMap"
        }
      }
    },
    "agreementReport": {
      "type": "record",
      "description": "An inter-annotator agreement report summarizing agreement metrics across judgment sets.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["experimentRef", "createdAt"],
        "properties": {
          "experimentRef": {
            "type": "string",
            "format": "at-uri"
          },
          "judgmentSetRefs": {
            "type": "array",
            "description": "The judgment sets compared.",
            "items": {
              "type": "string",
              "format": "at-uri"
            }
          },
          "metricUri": {
            "type": "string",
            "format": "at-uri",
            "description": "AT-URI of the metric definition node. Community-expandable via knowledge graph."
          },
          "metric": {
            "type": "string",
            "description": "Metric slug (fallback when metricUri unavailable).",
            "knownValues": ["cohens-kappa", "fleiss-kappa", "krippendorff-alpha", "percent-agreement", "correlation", "f1", "custom"],
            "maxLength": 128
          },
          "value": {
            "type": "integer",
            "description": "Metric value scaled 0-10000.",
            "minimum": 0,
            "maximum": 10000
          },
          "numAnnotators": {
            "type": "integer",
            "minimum": 1
          },
          "numItems": {
            "type": "integer",
            "minimum": 1
          },
          "features": {
            "type": "ref",
            "ref": "pub.layers.defs#featureMap"
          },
          "createdAt": {
            "type": "string",
            "format": "datetime"
          }
        }
      }
    }
  }
}
