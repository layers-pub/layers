{
  "lexicon": 1,
  "id": "pub.layers.graph",
  "description": "Generic typed property graph. Provides standalone graph nodes for entities/concepts/situations/claims, single directed typed edges between any Layers objects, and batch edge sets. Enables cross-document coreference, intertextual linking, knowledge-grounded annotation, and world-model construction.",
  "defs": {
    "graphNode": {
      "type": "record",
      "description": "A standalone node in the property graph. Represents entities, concepts, situations, claims, or any domain object that does not have another Layers record. Existing Layers records (expressions, annotations, typeDefs) are implicitly nodes via objectRef.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["nodeType", "createdAt"],
        "properties": {
          "nodeTypeUri": {
            "type": "string",
            "format": "at-uri",
            "description": "AT-URI of the node type definition node. Community-expandable via knowledge graph."
          },
          "nodeType": {
            "type": "string",
            "description": "Node type slug (fallback when nodeTypeUri unavailable).",
            "knownValues": ["entity", "concept", "situation", "state", "time", "location", "claim", "proposition", "custom"],
            "maxLength": 128
          },
          "label": {
            "type": "string",
            "description": "Human-readable node label.",
            "maxLength": 1024
          },
          "properties": {
            "type": "ref",
            "ref": "pub.layers.defs#featureMap",
            "description": "Node properties as key-value pairs."
          },
          "knowledgeRefs": {
            "type": "array",
            "description": "Knowledge graph references grounding this node (Wikidata, chive.pub, FrameNet, etc.).",
            "maxLength": 64,
            "items": {
              "type": "ref",
              "ref": "pub.layers.defs#knowledgeRef"
            }
          },
          "metadata": {
            "type": "ref",
            "ref": "pub.layers.defs#annotationMetadata"
          },
          "createdAt": {
            "type": "string",
            "format": "datetime"
          }
        }
      }
    },

    "graphEdge": {
      "type": "record",
      "description": "A single directed typed edge between any two Layers objects. Supports multidigraphs and cycles. Source and target use objectRef, which can point to local UUIDs, remote AT-URIs, or external knowledge graph nodes.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["source", "target", "edgeType", "createdAt"],
        "properties": {
          "source": {
            "type": "ref",
            "ref": "pub.layers.defs#objectRef",
            "description": "Source node: use localId for same-record UUID, recordRef for cross-record AT-URI, knowledgeRef for external KG."
          },
          "target": {
            "type": "ref",
            "ref": "pub.layers.defs#objectRef",
            "description": "Target node: use localId for same-record UUID, recordRef for cross-record AT-URI, knowledgeRef for external KG."
          },
          "edgeTypeUri": {
            "type": "string",
            "format": "at-uri",
            "description": "AT-URI of the edge type definition node. Community-expandable via knowledge graph."
          },
          "edgeType": {
            "type": "string",
            "description": "Edge type slug (fallback when edgeTypeUri unavailable).",
            "knownValues": [
              "reply-to", "quote", "repost", "translation-of", "continuation",
              "summary-of", "revision-of", "correction-of",
              "coreference", "causal", "part-of", "member-of",
              "type-of", "same-as", "related-to", "derived-from",
              "supports", "contradicts", "discourse", "bridging",
              "grounding", "instance-of", "denotes", "describes",
              "specializes", "elaborates", "produced-by", "described-in",
              "annotates", "see-also",
              "before", "after", "meets", "met-by",
              "overlaps", "overlapped-by", "starts", "started-by",
              "during", "contains", "finishes", "finished-by",
              "equals", "simultaneous",
              "initiates", "culminates", "terminates", "continues", "reinitiates",
              "disconnected", "externally-connected", "partially-overlapping",
              "tangential-proper-part", "non-tangential-proper-part",
              "tangential-proper-part-inverse", "non-tangential-proper-part-inverse",
              "spatially-equal",
              "north-of", "south-of", "east-of", "west-of",
              "above", "below", "in-front-of", "behind", "left-of", "right-of",
              "near", "far", "adjacent",
              "custom"
            ],
            "maxLength": 128
          },
          "label": {
            "type": "string",
            "description": "Optional edge label.",
            "maxLength": 512
          },
          "ordinal": {
            "type": "integer",
            "description": "Optional ordering among edges of the same type.",
            "minimum": 0
          },
          "confidence": {
            "type": "integer",
            "description": "Confidence 0-10000.",
            "minimum": 0,
            "maximum": 10000
          },
          "properties": {
            "type": "ref",
            "ref": "pub.layers.defs#featureMap",
            "description": "Edge properties as key-value pairs."
          },
          "metadata": {
            "type": "ref",
            "ref": "pub.layers.defs#annotationMetadata"
          },
          "createdAt": {
            "type": "string",
            "format": "datetime"
          }
        }
      }
    },

    "graphEdgeSet": {
      "type": "record",
      "description": "A batch of typed, directed edges between Layers objects. Use for bulk edge creation when many edges share the same provenance and context.",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["edges", "createdAt"],
        "properties": {
          "expression": {
            "type": "string",
            "format": "at-uri",
            "description": "Optional primary expression context."
          },
          "edgeTypeUri": {
            "type": "string",
            "format": "at-uri",
            "description": "AT-URI of the edge type definition node. Community-expandable via knowledge graph."
          },
          "edgeType": {
            "type": "string",
            "description": "Edge type slug shared by all edges in this set (fallback when edgeTypeUri unavailable).",
            "knownValues": [
              "coreference", "causal", "part-of", "member-of",
              "type-of", "same-as", "related-to", "derived-from",
              "supports", "contradicts", "discourse", "bridging",
              "before", "after", "meets", "met-by",
              "overlaps", "overlapped-by", "starts", "started-by",
              "during", "contains", "finishes", "finished-by",
              "equals", "simultaneous",
              "initiates", "culminates", "terminates", "continues", "reinitiates",
              "disconnected", "externally-connected", "partially-overlapping",
              "tangential-proper-part", "non-tangential-proper-part",
              "tangential-proper-part-inverse", "non-tangential-proper-part-inverse",
              "spatially-equal",
              "north-of", "south-of", "east-of", "west-of",
              "above", "below", "in-front-of", "behind", "left-of", "right-of",
              "near", "far", "adjacent",
              "custom"
            ],
            "maxLength": 128
          },
          "edges": {
            "type": "array",
            "items": {
              "type": "ref",
              "ref": "#graphEdgeEntry"
            }
          },
          "metadata": {
            "type": "ref",
            "ref": "pub.layers.defs#annotationMetadata"
          },
          "knowledgeRefs": {
            "type": "array",
            "description": "Knowledge graph references for this edge set (e.g., the relation ontology it implements, source methodology).",
            "maxLength": 32,
            "items": {
              "type": "ref",
              "ref": "pub.layers.defs#knowledgeRef"
            }
          },
          "features": {
            "type": "ref",
            "ref": "pub.layers.defs#featureMap",
            "description": "Open-ended features (e.g., extraction method, model version, confidence threshold)."
          },
          "createdAt": {
            "type": "string",
            "format": "datetime"
          }
        }
      }
    },

    "graphEdgeEntry": {
      "type": "object",
      "description": "A single directed edge entry within a graphEdgeSet.",
      "required": ["uuid", "source", "target", "edgeType"],
      "properties": {
        "uuid": {
          "type": "ref",
          "ref": "pub.layers.defs#uuid"
        },
        "edgeTypeUri": {
          "type": "string",
          "format": "at-uri",
          "description": "AT-URI of the edge type definition node. Overrides the set-level edgeType."
        },
        "edgeType": {
          "type": "string",
          "description": "Edge type slug. Overrides the set-level edgeType if different.",
          "maxLength": 256
        },
        "source": {
          "type": "ref",
          "ref": "pub.layers.defs#objectRef",
          "description": "Source node."
        },
        "target": {
          "type": "ref",
          "ref": "pub.layers.defs#objectRef",
          "description": "Target node."
        },
        "confidence": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10000
        },
        "features": {
          "type": "ref",
          "ref": "pub.layers.defs#featureMap"
        }
      }
    }
  }
}
